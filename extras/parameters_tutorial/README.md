# Using XSLT parameters in RENDER_STYLESHEETs

As explained in this module's main README, if a collection object has a datastream with an ID of 'RENDER_STYLESHEET', the XSLT transform in that datastream is applied to all XML objects that are members of the collection, unless a member object has its own RENDER_STYLESHEET datastream. In addition, parameters can be passed to the RENDER_STYLESHEET via URL query parameters, as long as the parameters are declared in the stylesheet; for example, `http://host/islandora/object/islandora:29?foo=true&bar=Mark` would make the values of `foo` and `bar` accessible in the stylesheet as follows:

```xml
  <xsl:param name="foo"></xsl:param>
  <xsl:param name="bar"></xsl:param>

  <xsl:if test="$foo='true' and $bar">
    <div>Hello <span><xsl:value-of select="$bar"/></span></div>
  </xsl:if>
```

The parameter 'pid' is always passed to the RENDER_STYLESHEET, providing stylesheet writers with access to the current object's PID, which is useful in generating URLs within the document.

This tutorial illustrates how URL parameters passed to a RENDER_STYLESHEET can be used to transform a single XML object, namely a three-chapter excerpt of Cory Doctorow's *[Down and Out in the Magic Kingdom](http://craphound.com/category/down/)* marked up in DocBook, so that specific chapters can be linked to from an auto-generated table of contents. The XML document is not large, but it allows us to demonstrate how to render only specific parts of the document. Doctorow's text is used here under a Creative Commons [Attribution-NonCommercial-ShareAlike 1.0 Generic](https://creativecommons.org/licenses/by-nc-sa/1.0/) license.

To see in action what is described below, create an object with the Islandora XML content model using the `downandout_docbook.xml` file as the object's OBJ datastream and the `RENDER_STYLESHEET.xsl` file as the RENDER_STYLESHEET datastream.

## Rendering the table of contents

The included RENDER_STYLESHEET's default behavior when viewing the object is to construct a simple table of contents using the source XML document's chapter titles and IDs. The logic within the stylesheet is that if the 'chapter' parameter is not present (in other words, the Islandora URL is the same as the one normally generated by Islandora when a user views an object), the following XSLT will be applied to the current `<docbook:chapter>` element:

```xml
  <!-- The check for the 'chapter' XSLT parameter, which comes from the corresponding URL query parameter. -->
  <xsl:if test="not($chapter)">
   <!-- If the parameter is not set, generate an entry in the table of contents. -->
    <p><a href="/islandora/object/{$pid}?chapter={./@xml:id}"><xsl:value-of select="docbook:title"/></a></p>
  </xsl:if>
```

The result is HTML output that contains a link for each chapter title, each one containing the chapter's `xml:id` attribute value as a URL parameter. The rendered version of the table of contents looks like this:

![Down and Out in the Magic Kingdom table of contents](https://dl.dropboxusercontent.com/u/1015702/linked_to/islandora_solution_pack_xml/parameters_toc.png)


## Rendering a specific chapter

If the 'chapter' parameter is passed to the stylesheet, its value is used to determine which `<chapter>` node in the document to render to the user. The XSLT used to do this is:

```xml
  <xsl:if test="$chapter">
    <xsl:if test="./@xml:id=$chapter">
      <h2><xsl:value-of select="docbook:title"/></h2>
       <xsl:for-each select="docbook:para">
         <p><xsl:value-of select="."/></p>
       </xsl:for-each>
       <div><a href="/islandora/object/{$pid}">Table of contents</a></div>
    </xsl:if>
  </xsl:if>
```

The chapter's `<title>` element, plus each of its `<para>` elements, are transformed into simple HTML markup. This XSLT also adds a link back to the table of contents (in other words, a link back to the object's standard URL). The rendered versionn of the Prologue, for example, looks like this:

![Down and Out in the Magic Kingdom Prologue](https://dl.dropboxusercontent.com/u/1015702/linked_to/islandora_solution_pack_xml/parameters_chapter.png)

## Rendering the entire document

If the 'chapter' parameter contains the reserved value 'all', the following XSLT is applied to each `<chapter>` node in the object's XML, rendering it in the same way as individual chapters are rendered:

```xml
  <xsl:if test="$chapter='all'">
    <h2><xsl:value-of select="docbook:title"/></h2>
    <xsl:for-each select="docbook:para">
      <p><xsl:value-of select="."/></p>
    </xsl:for-each>
    <div><a href="/islandora/object/{$pid}">Table of contents</a></div>
  </xsl:if>
```

## Conclusion

Rendering an entire XML document out to end users may not be the most effective way to deliver a large XML document's content. By passing URL parameters into your RENDER_STYLESHEET, it's possible to render specific nodes in the document instead. Generating a table of contents with links to specific nodes allows the user to choose which node they want. The example used in this tutorial didn't add any CSS styling to the output, or links to image datastreams, but both of those things would be fairly easy to do. This tutorial used a RENDER_STYLESHEET to transform a single XML object, but the same stylesheet could be used on an entire collection of similarly structured documents.
